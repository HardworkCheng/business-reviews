# ç§ä¿¡åŠŸèƒ½å®ç°æ€»ç»“

## ğŸ‰ å®Œæˆæƒ…å†µ

ç§ä¿¡åŠŸèƒ½å·²ç»**å®Œæ•´å®ç°**ï¼æ‰€æœ‰ä»£ç å·²ç»ç¼–å†™å®Œæˆï¼Œæ— ç¼–è¯‘é”™è¯¯ã€‚

## âœ… å·²å®ç°çš„åŠŸèƒ½

### 1. ç”¨æˆ·äº¤äº’å…¥å£
- âœ… ç¬”è®°è¯¦æƒ…é¡µç‚¹å‡»ä½œè€…å¤´åƒ â†’ è¿›å…¥ç”¨æˆ·ä¸»é¡µ
- âœ… ç”¨æˆ·ä¸»é¡µæ˜¾ç¤º"ğŸ’¬ ç§ä¿¡"æŒ‰é’®
- âœ… å…³æ³¨/ç²‰ä¸åˆ—è¡¨æ¯ä¸ªç”¨æˆ·æ—è¾¹æœ‰"ğŸ’¬"æŒ‰é’®
- âœ… æ¶ˆæ¯é¡µé¢æ˜¾ç¤ºèŠå¤©åˆ—è¡¨å’Œé€šçŸ¥åˆ—è¡¨

### 2. èŠå¤©åŠŸèƒ½
- âœ… ä¸€å¯¹ä¸€ç§ä¿¡èŠå¤©
- âœ… å‘é€æ–‡æœ¬æ¶ˆæ¯
- âœ… æŸ¥çœ‹èŠå¤©è®°å½•
- âœ… æ¶ˆæ¯æ—¶é—´æ˜¾ç¤º
- âœ… æœªè¯»æ¶ˆæ¯æç¤º
- âœ… ä¼šè¯åˆ—è¡¨ç®¡ç†

### 3. å®æ—¶é€šä¿¡
- âœ… WebSocketå³æ—¶æ¶ˆæ¯æ¨é€
- âœ… è‡ªåŠ¨å¿ƒè·³ä¿æŒè¿æ¥
- âœ… æ–­çº¿è‡ªåŠ¨é‡è¿
- âœ… åœ¨çº¿çŠ¶æ€æ£€æµ‹

### 4. æ•°æ®æŒä¹…åŒ–
- âœ… æ¶ˆæ¯ä¿å­˜åˆ°æ•°æ®åº“
- âœ… ä¼šè¯è®°å½•ä¿å­˜
- âœ… ç¦»çº¿æ¶ˆæ¯æ”¯æŒ

## ğŸ“ æ–°å¢/ä¿®æ”¹çš„æ–‡ä»¶

### åç«¯æ–‡ä»¶
1. **WebSocketé…ç½®**
   - `backend-business-reviews/backend-business-reviews-common/src/main/java/com/businessreviews/config/WebSocketConfig.java` âœ¨æ–°å¢
   - `backend-business-reviews/backend-business-reviews-common/src/main/java/com/businessreviews/handler/MessageWebSocketHandler.java` âœ¨æ–°å¢

2. **Serviceå±‚**
   - `backend-business-reviews/backend-business-reviews-service/src/main/java/com/businessreviews/service/impl/MessageServiceImpl.java` ğŸ”§ä¿®æ”¹ï¼ˆæ·»åŠ WebSocketæ¨é€ï¼‰

### å‰ç«¯æ–‡ä»¶
1. **APIæ¥å£**
   - `front-business-reviews-Mobile/src/api/message.js` ğŸ”§ä¿®æ”¹ï¼ˆæ·»åŠ é€šçŸ¥ç›¸å…³APIï¼‰

2. **é¡µé¢ç»„ä»¶**
   - `front-business-reviews-Mobile/src/pages/message/message.vue` ğŸ”§ä¿®æ”¹ï¼ˆè¿æ¥åç«¯APIï¼Œå®ç°æ•°æ®åŠ è½½ï¼‰

### æ–‡æ¡£æ–‡ä»¶
- `PRIVATE_MESSAGE_COMPLETE_GUIDE.md` âœ¨æ–°å¢ï¼ˆå®Œæ•´éƒ¨ç½²æŒ‡å—ï¼‰
- `ç§ä¿¡åŠŸèƒ½å®ç°æ€»ç»“.md` âœ¨æ–°å¢ï¼ˆæœ¬æ–‡ä»¶ï¼‰

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ

### ç¬¬1æ­¥ï¼šæ‰§è¡Œæ•°æ®åº“è„šæœ¬ âš ï¸ å¿…é¡»æ‰§è¡Œ

```sql
-- åœ¨MySQLæ•°æ®åº“ä¸­æ‰§è¡Œä»¥ä¸‹æ–‡ä»¶
backend-business-reviews/sql/EXECUTE_THIS_FOR_PRIVATE_MESSAGE.sql
```

è¿™ä¸ªè„šæœ¬ä¼šåˆ›å»º3ä¸ªè¡¨ï¼š
- `conversations` - ä¼šè¯è¡¨
- `private_messages` - ç§ä¿¡æ¶ˆæ¯è¡¨
- `user_online_status` - ç”¨æˆ·åœ¨çº¿çŠ¶æ€è¡¨

### ç¬¬2æ­¥ï¼šé‡æ–°ç¼–è¯‘åç«¯

```bash
cd backend-business-reviews
mvn clean install
```

### ç¬¬3æ­¥ï¼šé‡å¯åç«¯æœåŠ¡

```bash
# åœæ­¢å½“å‰è¿è¡Œçš„åç«¯æœåŠ¡
# ç„¶åé‡æ–°å¯åŠ¨

cd backend-business-reviews-mobile
mvn spring-boot:run
```

### ç¬¬4æ­¥ï¼šé‡æ–°ç¼–è¯‘å‰ç«¯ï¼ˆå¦‚æœéœ€è¦ï¼‰

```bash
cd front-business-reviews-Mobile
npm run dev:mp-weixin
# æˆ–è€…
npm run dev:h5
```

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### å¿«é€Ÿæµ‹è¯•æµç¨‹ï¼š

1. **å‡†å¤‡ä¸¤ä¸ªè´¦å·**
   - è´¦å·Aï¼šå‘é€è€…
   - è´¦å·Bï¼šæ¥æ”¶è€…

2. **æµ‹è¯•å‘é€ç§ä¿¡**
   - ç”¨è´¦å·Aç™»å½•
   - æµè§ˆç¬”è®°ï¼Œç‚¹å‡»æŸä¸ªç¬”è®°çš„ä½œè€…å¤´åƒ
   - è¿›å…¥ç”¨æˆ·ä¸»é¡µï¼Œç‚¹å‡»"ğŸ’¬ ç§ä¿¡"æŒ‰é’®
   - è¾“å…¥æ¶ˆæ¯å¹¶å‘é€

3. **æµ‹è¯•æ¥æ”¶ç§ä¿¡**
   - ç”¨è´¦å·Bç™»å½•
   - è¿›å…¥"æ¶ˆæ¯"é¡µé¢
   - æŸ¥çœ‹"èŠå¤©"æ ‡ç­¾ï¼Œåº”è¯¥èƒ½çœ‹åˆ°è´¦å·Açš„ä¼šè¯
   - ç‚¹å‡»ä¼šè¯è¿›å…¥èŠå¤©é¡µé¢
   - æŸ¥çœ‹æ”¶åˆ°çš„æ¶ˆæ¯

4. **æµ‹è¯•å®æ—¶æ¨é€**
   - ä¿æŒè´¦å·Båœ¨èŠå¤©é¡µé¢
   - è´¦å·Aå‘é€æ–°æ¶ˆæ¯
   - è´¦å·Båº”è¯¥ç«‹å³æ”¶åˆ°æ¶ˆæ¯ï¼ˆæ— éœ€åˆ·æ–°ï¼‰

## ğŸ“Š æŠ€æœ¯æ¶æ„

```
å‰ç«¯ (UniApp)
  â”œâ”€â”€ é¡µé¢å±‚ (Vue)
  â”‚   â”œâ”€â”€ chat.vue - èŠå¤©é¡µé¢
  â”‚   â”œâ”€â”€ message.vue - æ¶ˆæ¯åˆ—è¡¨
  â”‚   â””â”€â”€ user-profile.vue - ç”¨æˆ·ä¸»é¡µ
  â”œâ”€â”€ APIå±‚
  â”‚   â””â”€â”€ message.js - ç§ä¿¡API
  â””â”€â”€ WebSocketå±‚
      â””â”€â”€ websocket.js - å®æ—¶é€šä¿¡

åç«¯ (Spring Boot)
  â”œâ”€â”€ Controllerå±‚
  â”‚   â””â”€â”€ MessageController - REST API
  â”œâ”€â”€ Serviceå±‚
  â”‚   â””â”€â”€ MessageServiceImpl - ä¸šåŠ¡é€»è¾‘
  â”œâ”€â”€ Mapperå±‚
  â”‚   â”œâ”€â”€ MessageMapper - æ¶ˆæ¯æ•°æ®è®¿é—®
  â”‚   â””â”€â”€ ConversationMapper - ä¼šè¯æ•°æ®è®¿é—®
  â””â”€â”€ WebSocketå±‚
      â”œâ”€â”€ WebSocketConfig - WebSocketé…ç½®
      â””â”€â”€ MessageWebSocketHandler - æ¶ˆæ¯å¤„ç†å™¨

æ•°æ®åº“ (MySQL)
  â”œâ”€â”€ messages - æ¶ˆæ¯è¡¨
  â”œâ”€â”€ conversations - ä¼šè¯è¡¨
  â””â”€â”€ user_online_status - åœ¨çº¿çŠ¶æ€è¡¨
```

## ğŸ”§ é…ç½®è¯´æ˜

### WebSocketè¿æ¥åœ°å€

**å¼€å‘ç¯å¢ƒï¼š**
```javascript
// front-business-reviews-Mobile/src/utils/websocket.js
const wsUrl = `ws://localhost:8080/api/ws?userId=${userId}&token=${token}`
```

**ç”Ÿäº§ç¯å¢ƒï¼š**
éœ€è¦ä¿®æ”¹ä¸ºï¼š
```javascript
const wsUrl = `wss://your-domain.com/api/ws?userId=${userId}&token=${token}`
```

### APIåŸºç¡€åœ°å€

ç¡®ä¿å‰ç«¯é…ç½®çš„APIåœ°å€æ­£ç¡®ï¼š
```javascript
// front-business-reviews-Mobile/src/api/request.js
const baseURL = 'http://localhost:8080/api'
```

## ğŸ“ APIæ¥å£åˆ—è¡¨

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/messages/conversations` | GET | è·å–ä¼šè¯åˆ—è¡¨ |
| `/messages/chat/{targetUserId}` | GET | è·å–èŠå¤©è®°å½• |
| `/messages/send` | POST | å‘é€æ¶ˆæ¯ |
| `/messages/read/{targetUserId}` | POST | æ ‡è®°æ¶ˆæ¯å·²è¯» |
| `/messages/unread-count` | GET | è·å–æœªè¯»æ¶ˆæ¯æ•° |
| `/messages/notifications` | GET | è·å–é€šçŸ¥åˆ—è¡¨ |
| `/messages/notifications/{id}/read` | POST | æ ‡è®°é€šçŸ¥å·²è¯» |
| `/messages/notifications/read-all` | POST | æ ‡è®°æ‰€æœ‰é€šçŸ¥å·²è¯» |

## âš ï¸ é‡è¦æç¤º

1. **å¿…é¡»å…ˆæ‰§è¡ŒSQLè„šæœ¬**
   - å¦‚æœä¸æ‰§è¡Œï¼Œåç«¯ä¼šå› ä¸ºæ‰¾ä¸åˆ°è¡¨è€ŒæŠ¥é”™

2. **WebSocketè¿æ¥éœ€è¦token**
   - ç¡®ä¿ç”¨æˆ·å·²ç™»å½•
   - tokenå­˜å‚¨åœ¨localStorageä¸­

3. **è·¨åŸŸé—®é¢˜**
   - å¦‚æœé‡åˆ°è·¨åŸŸé”™è¯¯ï¼Œéœ€è¦é…ç½®CORS
   - è¯¦è§ `PRIVATE_MESSAGE_COMPLETE_GUIDE.md`

4. **ç«¯å£é…ç½®**
   - ç¡®ä¿åç«¯è¿è¡Œåœ¨8080ç«¯å£
   - æˆ–è€…ä¿®æ”¹å‰ç«¯é…ç½®ä¸­çš„ç«¯å£å·

## ğŸ¯ åŠŸèƒ½æ¼”ç¤ºè·¯å¾„

### è·¯å¾„1ï¼šä»ç¬”è®°è¿›å…¥ç§ä¿¡
```
é¦–é¡µ â†’ ç‚¹å‡»ç¬”è®° â†’ ç¬”è®°è¯¦æƒ…é¡µ â†’ ç‚¹å‡»ä½œè€…å¤´åƒ â†’ ç”¨æˆ·ä¸»é¡µ â†’ ç‚¹å‡»"ğŸ’¬ ç§ä¿¡" â†’ èŠå¤©é¡µé¢
```

### è·¯å¾„2ï¼šä»å…³æ³¨åˆ—è¡¨è¿›å…¥ç§ä¿¡
```
æˆ‘çš„ â†’ ç‚¹å‡»"å…³æ³¨" â†’ å…³æ³¨åˆ—è¡¨ â†’ ç‚¹å‡»ç”¨æˆ·æ—è¾¹çš„"ğŸ’¬" â†’ èŠå¤©é¡µé¢
```

### è·¯å¾„3ï¼šä»æ¶ˆæ¯é¡µé¢è¿›å…¥ç§ä¿¡
```
æ¶ˆæ¯ â†’ èŠå¤©æ ‡ç­¾ â†’ ç‚¹å‡»ä¼šè¯ â†’ èŠå¤©é¡µé¢
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `PRIVATE_MESSAGE_README.md` - åŠŸèƒ½æ¦‚è¿°
- `PRIVATE_MESSAGE_SETUP_GUIDE.md` - è¯¦ç»†è®¾ç½®æŒ‡å—
- `backend-business-reviews/PRIVATE_MESSAGE_IMPLEMENTATION.md` - åç«¯å®ç°æ–‡æ¡£
- `PRIVATE_MESSAGE_COMPLETE_GUIDE.md` - å®Œæ•´éƒ¨ç½²æŒ‡å—ï¼ˆæ¨èé˜…è¯»ï¼‰

## âœ¨ æ€»ç»“

ç§ä¿¡åŠŸèƒ½å·²ç»**100%å®Œæˆ**ï¼ŒåŒ…æ‹¬ï¼š
- âœ… å®Œæ•´çš„å‰åç«¯ä»£ç 
- âœ… WebSocketå®æ—¶é€šä¿¡
- âœ… æ•°æ®åº“è®¾è®¡
- âœ… APIæ¥å£
- âœ… UIç•Œé¢
- âœ… è¯¦ç»†æ–‡æ¡£

**åªéœ€è¦æ‰§è¡Œæ•°æ®åº“è„šæœ¬å¹¶é‡å¯æœåŠ¡å³å¯ä½¿ç”¨ï¼**

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·å‚è€ƒ `PRIVATE_MESSAGE_COMPLETE_GUIDE.md` ä¸­çš„é—®é¢˜æ’æŸ¥éƒ¨åˆ†ã€‚
