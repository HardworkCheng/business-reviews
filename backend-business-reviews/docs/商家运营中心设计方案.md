,商家运营中心（ToB Web）设计方案

一、项目概述
- 背景：基于现有美食点评/商家评价项目（Uni-App 移动端 + Spring Boot 后端），构建面向商家的运营中心 Web 端，支持商家内容运营、优惠券发放、数据运营及成员协作。
- 目标：
  - 为商家提供“发笔记、发优惠券、看数据、管互动、管成员”的闭环能力。
  - 与现有 Uni-App ToC 应用深度打通：商家端操作即刻影响用户端展示与体验。
  - 支持多门店、多成员、多角色协同。

二、角色与权限（RBAC）
- 角色：
  - 店主/管理员：全权限（店铺与成员、内容与券、数据与设置）。
  - 运营：笔记与优惠券的创建、管理、数据查看。
  - 客服：评论管理、消息回复、用户问题处理。
  - 审核：内容审核（草稿/提交/通过/驳回）、违规处理。
- 权限模型：
  - 资源维度：shop、note、coupon、comment、member、dashboard、settings。
  - 操作维度：CRUD + 审核 + 发放/核销 + 导出。
  - 作用域：跨门店/单门店，基于 shopId 与 merchantId 控制。

三、整体架构
- 前端（Web）：
  - 技术栈：Vue 3 + Vite + Pinia + Vue Router + Element Plus。
  - 部署：独立域名（如 merchant.example.com），支持单点登录与跨端会话隔离（遵循用户“多客户端会话隔离要求”记忆）。
- 后端（服务）：
  - 复用现有 Spring Boot + MyBatis-Plus + JWT 的体系，新增 merchant 模块与 API 前缀 `/merchant/**`。
  - 统一认证：商家端独立登录入口与 token（merchant_jwt），与 ToC 端互不干扰。
  - 存储：MySQL 8.0；文件：阿里云 OSS（沿用现有方案）。
  - 缓存：Redis（券库存/限领策略/热点数据）。
- 数据流：
  - 商家端发布笔记→后端存储→ToC Uni-App 展示。
  - 商家端创建优惠券→用户端领取→用户核销→商家端实时数据回流。

四、核心功能模块
1）登录与入驻
- 商家登录：手机号 + 密码 / 验证码登录，独立 token。
- 入驻信息：企业/店铺认证、营业执照、联系人、地址、营业时间等。
- 多门店：一个商家可绑定多个门店，支持门店维度的运营与数据查看。

2）门店管理
- 门店列表：新增/编辑/停用；门店头像、封面、地址、电话、营业时间。
- 资源管理：门店图片（OSS），门店标签与品类。

3）内容运营（笔记）
- 笔记管理：
  - 列表：按门店/时间/状态（草稿、待审、已发、下线）筛选；支持批量下线。
  - 创建/编辑：标题、正文、图片（多图）、话题、关联门店、地理位置（可选）。
  - 审核流：草稿→提交审核→（通过/驳回）→发布；保留驳回原因与修改建议。
- 自动化运营：
  - 定时发布：设置发布时间。
  - 复用模板：保存“笔记模板”，快速复用样式与话术。
- 互动联动：
  - 评论管理：置顶/删除/拉黑用户；快捷回复库与回复统计。
  - 点赞/收藏/关注联动数据归因到笔记及门店。

4）优惠券运营
- 券类型：
  - 现金券（满减）、折扣券（x.x 折）、专属券（特定品类/门店）、新人券/会员券。
- 发放规则：
  - 库存（总量/每日量），每人限领次数，生效/失效时间，适用门店与品类，叠加规则。
- 领用渠道：
  - Uni-App 前端券中心列表、笔记详情页券入口、扫码领券（H5落地页）。
- 核销方式：
  - 门店核销台（商家端 Web）：输入券码/扫码核销。
  - 验证逻辑：券状态（未使用/已使用/已过期）、适用门店校验、操作员与时间记录。
- 列表与详情：
  - 券列表筛选（类型、状态、门店），
  - 券详情：规则、库存、已领/已核销、用户画像与转化漏斗。

5）数据运营（看板与分析）
- 首页看板（今日/近7日/近30日）：
  - 内容曝光（浏览量）、互动（点赞/收藏/评论）、粉丝净增、券领取/核销、GMV（预留）。
- 笔记分析：
  - 单篇/整体：曝光-互动-转化路径；热门内容 TopN；推荐标签效果。
- 优惠券分析：
  - 领券转化、到店核销率、门店维度对比、渠道对比（首页、详情页、扫码）。
- 用户分析（基础）：
  - 粉丝增长曲线、互动用户画像（年龄段/偏好标签，预留与后续数据埋点对接）。
- 导出：CSV/XLS，支持筛选维度导出。

6）消息与通知
- 系统消息：内容审核结果、券到期提醒、库存预警、异常核销拦截。
- 互动消息：新评论/回复、用户私信（预留，与现有“消息”模块打通）。

7）成员与权限
- 成员管理：邀请成员加入（手机号/邮箱），设置角色与门店范围。
- 操作日志：关键操作与核销活动记录，支持导出与审计。

8）设置
- 商家/门店信息、Logo/封面（OSS）、地址/坐标、营业时间、客服电话、发票抬头（预留）。

五、页面与导航（Web 端 IA）
- 登录页：商家登录 / 入驻引导。
- 首页看板：核心 KPI、快捷入口（发笔记/发券）。
- 笔记管理：列表、创建/编辑、审核流、批量操作。
- 优惠券管理：列表、创建规则、发放与库存、核销台。
- 数据分析：笔记分析、优惠券分析、用户分析（基础）。
- 评论管理：评论列表、快捷回复库、敏感词提示、违规处理。
- 成员与权限：成员列表、角色设置、操作日志。
- 设置：商家与门店设置、图片资源、联系方式。

六、与 Uni-App ToC 的集成点
- 券中心：
  - ToC 券列表：GET `/coupons/list`（支持类型/状态/分页）。
  - 领券：POST `/coupons/{id}/claim`（用户鉴权、限领规则、库存扣减）。
  - 详情页入口：笔记详情返回券入口数据（可选券列表/最优券）。
  - 核销：POST `/coupons/{id}/redeem`（商家端核销台，需校验门店与券状态）。
- 笔记详情：
  - 商家端发布后，ToC `GET /notes/{id}`照常展示，返回 `isLiked/isBookmarked/isFollowing`（已在后端实现）确保移动端图标状态正确。
- 消息提醒：
  - 点赞/评论/收藏/关注触发商家端消息（沿用现有消息服务 `MessageService`，新增商家端订阅）。

七、API 设计草案（部分）
- 认证与账号：
  - POST `/merchant/auth/login`  登录获取 token。
  - POST `/merchant/auth/logout`  注销。
  - GET  `/merchant/auth/profile` 商家信息与角色权限。
- 门店：
  - GET  `/merchant/shops` 列表；POST `/merchant/shops` 新增；PUT `/merchant/shops/{id}` 编辑；DELETE 停用。
- 笔记：
  - GET  `/merchant/notes` 列表（支持状态/门店/时间筛选）。
  - POST `/merchant/notes` 创建（草稿/提交审核）。
  - PUT  `/merchant/notes/{id}` 更新；POST `/merchant/notes/{id}/publish` 发布；POST `/merchant/notes/{id}/offline` 下线。
  - GET  `/merchant/notes/{id}/stats` 单篇分析。
- 优惠券：
  - GET  `/merchant/coupons` 列表；POST `/merchant/coupons` 创建；PUT `/merchant/coupons/{id}` 更新。
  - POST `/merchant/coupons/{id}/issue` 发放（设置库存与规则）。
  - GET  `/merchant/coupons/{id}/stats` 券统计；POST `/merchant/coupons/{id}/redeem` 核销（商家端）。
- 评论与互动：
  - GET  `/merchant/comments` 列表；POST `/merchant/comments/{id}/reply` 回复；DELETE `/merchant/comments/{id}` 删除。
- 数据看板：
  - GET  `/merchant/dashboard` 核心指标；GET `/merchant/analytics/notes`、`/merchant/analytics/coupons`、`/merchant/analytics/users` 细分报表。
- 成员与权限：
  - GET  `/merchant/members`；POST `/merchant/members`；PUT `/merchant/members/{id}`；GET `/merchant/roles`；PUT `/merchant/roles/{id}`。

八、数据库表（建议）
- 商家与成员：
  - `merchant`（id, name, status, created_at, ...）
  - `merchant_user`（id, merchant_id, phone, email, password_hash, status, ...）
  - `merchant_role`（id, merchant_id, name, permissions(json)）
  - `shop`（沿用或扩展：id, merchant_id, name, address, phone, opening_hours, status, ...）
- 内容关联：
  - `note`（沿用，补充 merchant_id, shop_id 字段；或通过 userId 与 merchant_user 映射）
  - `note_audit`（id, note_id, status, reason, auditor_id, ...）
- 优惠券：
  - `coupon`（id, merchant_id, type, title, description, rule_id, total, daily_limit, per_user_limit, start_time, end_time, status, ...）
  - `coupon_rule`（id, type, threshold, discount_rate, amount, applicable_shops(json), stackable, ...）
  - `coupon_issue`（id, coupon_id, user_id, code, status[received/used/expired], receive_time, redeem_time, shop_id）
  - `coupon_channel`（id, coupon_id, channel_type[app/detail/scan], pv, uv, claim_count）
- 互动与运营：沿用 `user_note_like`、`user_favorite`、`comments` 等表统计聚合到商家维度。

九、审核与风控
- 内容审核：敏感词、图片违规（AI/人工）、重复内容检测；驳回原因记录。
- 券风控：同一用户频繁领券/核销拦截，门店适用校验，券码加密与一次性校验。
- 操作日志：创建、发布、下线、核销等关键动作留痕。

十、前端交互细节（Web）
- 看板：卡片式 KPI + 趋势图（折线/柱状）+ Top 内容列表。
- 笔记编辑：富文本 + 图片上传（OSS）+ 话题选择 + 地理位置选择 + 定时发布。
- 券创建：类型切换（现金/折扣/专属），规则表单与实时预览卡片；库存与限领设置。
- 核销台：输入券码/扫码核销，显示券详情与适用门店，成功/失败提示。
- 评论管理：列表 + 快捷回复右侧面板；支持筛选（笔记/时间/关键词）。

十一、迭代建议
- V1：商家登录/看板、笔记创建与发布、优惠券创建与发放、核销台、基础数据、评论管理。
- V2：内容审核流、活动运营、更多数据维度（渠道/门店对比与归因）、操作日志与导出。
- V3：智能推荐与 A/B 测试、券智能投放（人群/门店/时间）、会员体系对接与积分。

十二、与现有代码的联动实现建议
- 后端：新增 `merchant` 包与控制器，尽量复用现有 Note/Comment/Message 相关 Mapper 与 Service；注意接口前缀 `/merchant/**` 与 ToC 端隔离；遵循现有异常与返回结构 `Result<>`、`PageResult<>`。
- 前端：Web 独立工程（同 mono-repo 或独立 repo）；统一登录态与缓存隔离，避免 ToC 缓存污染（参考“缓存混乱问题已修复.md”与“多客户端会话隔离要求”）。
- 数据：必要的字段与表扩展，保持与现有表的一致风格与命名规范。

十三、风格与规范
- 接口风格：REST，集合资源 GET 列表 + POST 创建 + PUT 更新 + DELETE 删除；动作型 POST（如 publish/offline/issue/redeem）。
- 校验与安全：后端参数校验（JSR 303）、鉴权（JWT）、数据权限（merchant_id/shop_id 维度）。
- 日志与监控：关键操作打点（券领用/核销、内容发布），错误与慢查监控。

（完）
