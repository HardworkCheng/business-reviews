# 修复编译错误说明

## 问题原因

编译错误是因为 `MessageWebSocketHandler` 和 `WebSocketConfig` 类使用了 Spring WebSocket 的类（如 `WebSocketSession`、`TextMessage` 等），但项目中缺少相应的 Maven 依赖。

## 已完成的修复

我已经在 `backend-business-reviews-common/pom.xml` 中添加了 WebSocket 依赖：

```xml
<!-- Spring Boot Starter WebSocket -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-websocket</artifactId>
</dependency>
```

## 下一步操作

### 方法1：在 IDEA 中重新加载 Maven 项目（推荐）

1. 打开 IDEA
2. 找到右侧的 Maven 工具窗口
3. 点击刷新按钮（Reload All Maven Projects）
4. 等待依赖下载完成
5. 重新编译项目

### 方法2：使用命令行重新编译

```bash
cd backend-business-reviews
mvn clean install -DskipTests
```

### 方法3：删除 IDEA 缓存并重新导入

1. 关闭 IDEA
2. 删除项目根目录下的 `.idea` 文件夹
3. 删除所有模块下的 `*.iml` 文件
4. 重新用 IDEA 打开项目
5. 等待 Maven 自动导入依赖

## 验证修复

编译成功后，应该不会再出现以下错误：
- `找不到符号: 类 WebSocketSession`
- `找不到符号: 类 TextMessage`
- `找不到符号: 类 CloseStatus`
- `找不到符号: 类 TextWebSocketHandler`

## 如果仍然有错误

如果重新加载 Maven 后仍然有错误，请检查：

1. **网络连接**：确保可以访问 Maven 中央仓库
2. **Maven 配置**：检查 `settings.xml` 中的镜像配置
3. **依赖冲突**：查看是否有其他模块引入了冲突的依赖版本

## 完整的依赖列表

`backend-business-reviews-common/pom.xml` 现在包含以下依赖：

```xml
<dependencies>
    <!-- Spring Boot Starter Data Redis -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-data-redis</artifactId>
    </dependency>
    
    <!-- Spring Boot Starter WebSocket -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-websocket</artifactId>
    </dependency>
    
    <!-- Jackson 用于JSON处理 -->
    <dependency>
        <groupId>com.fasterxml.jackson.datatype</groupId>
        <artifactId>jackson-datatype-jsr310</artifactId>
    </dependency>
    
    <!-- JWT -->
    <dependency>
        <groupId>io.jsonwebtoken</groupId>
        <artifactId>jjwt-api</artifactId>
    </dependency>
    <dependency>
        <groupId>io.jsonwebtoken</groupId>
        <artifactId>jjwt-impl</artifactId>
        <scope>runtime</scope>
    </dependency>
    <dependency>
        <groupId>io.jsonwebtoken</groupId>
        <artifactId>jjwt-jackson</artifactId>
        <scope>runtime</scope>
    </dependency>
    
    <!-- Hutool 工具类 -->
    <dependency>
        <groupId>cn.hutool</groupId>
        <artifactId>hutool-all</artifactId>
    </dependency>
    
    <!-- 阿里云SMS短信 -->
    <dependency>
        <groupId>com.aliyun</groupId>
        <artifactId>dysmsapi20170525</artifactId>
    </dependency>
</dependencies>
```

## 注意事项

1. **首次下载**：如果是第一次下载 WebSocket 依赖，可能需要几分钟时间
2. **代理设置**：如果在公司网络环境，可能需要配置 Maven 代理
3. **版本兼容**：Spring Boot 3.2.0 自带的 WebSocket 版本是兼容的，无需指定版本号

## 编译成功后的下一步

1. 执行 SQL 脚本：`backend-business-reviews/sql/EXECUTE_THIS_FOR_PRIVATE_MESSAGE.sql`
2. 启动后端服务
3. 测试私信功能

如果还有其他问题，请提供完整的错误日志。
