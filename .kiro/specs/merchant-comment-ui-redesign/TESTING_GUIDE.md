# 评论管理功能测试指南

## 前置条件

### 1. 数据库准备

确保数据库中有以下测试数据：

```sql
-- 1. 确保有商家账号
SELECT * FROM merchants WHERE id = 1;

-- 2. 确保商家有门店
SELECT * FROM shops WHERE merchant_id = 1;

-- 3. 确保门店有笔记
SELECT * FROM notes WHERE shop_id IN (SELECT id FROM shops WHERE merchant_id = 1);

-- 4. 确保笔记有评论
SELECT * FROM note_comments WHERE note_id IN (
  SELECT id FROM notes WHERE shop_id IN (
    SELECT id FROM shops WHERE merchant_id = 1
  )
);
```

### 2. 创建测试数据（如果没有）

```sql
-- 插入测试评论
INSERT INTO note_comments (note_id, user_id, content, like_count, reply_count, status, created_at, updated_at)
VALUES 
(1, 1, '这家店的服务真的很好，环境也很舒适！', 10, 0, 1, NOW(), NOW()),
(1, 2, '味道不错，但是价格有点贵', 5, 0, 1, NOW(), NOW()),
(1, 3, '非常满意，下次还会再来！', 15, 0, 1, NOW(), NOW()),
(2, 4, '一般般，没有想象中的好', 2, 0, 1, NOW(), NOW()),
(2, 5, '服务态度很差，不推荐', 0, 0, 2, NOW(), NOW());

-- 插入商家回复
INSERT INTO note_comments (note_id, user_id, parent_id, content, like_count, reply_count, status, created_at, updated_at)
VALUES 
(1, 100, 1, '感谢您的好评！我们会继续努力提供更好的服务！', 0, 0, 1, NOW(), NOW());
```

## 测试步骤

### 1. 启动服务

#### 后端
```bash
cd backend-business-reviews
mvn clean install
mvn spring-boot:run
```

#### 前端
```bash
cd front-business-reviews-Web
npm install
npm run dev
```

### 2. 登录商家账号

访问：`http://localhost:5173/login`

使用商家账号登录（确保是有门店和笔记的商家）

### 3. 访问评论管理页面

访问：`http://localhost:5173/comment/list`

## 功能测试清单

### ✅ 1. 数据概览卡片

**测试内容**：
- [ ] 今日新增评论数显示正确
- [ ] 今日趋势显示正确（上升/下降/持平）
- [ ] 店铺综合评分显示
- [ ] 待回复内容数显示正确
- [ ] 差评/投诉待处理数显示
- [ ] 卡片悬停有上浮动画效果

**预期结果**：
- 数据卡片显示真实数据
- 趋势指标用颜色区分（绿色上升/红色下降）
- 悬停时卡片上浮，阴影加深

### ✅ 2. Tab筛选功能

**测试内容**：
- [ ] 点击"全部评论"Tab，显示所有评论
- [ ] 点击"正常显示"Tab，只显示status=1的评论
- [ ] 点击"已删除"Tab，只显示status=2的评论
- [ ] 每个Tab显示对应的评论数量
- [ ] Tab切换时保持搜索条件

**预期结果**：
- Tab切换流畅
- 评论列表根据Tab筛选
- Tab标签显示正确的数量

### ✅ 3. 评论列表显示

**测试内容**：
- [ ] 用户头像显示正确
- [ ] 用户名显示正确
- [ ] VIP标签显示（如果是VIP用户）
- [ ] 匿名标签显示（如果是匿名评论）
- [ ] 评论内容显示完整
- [ ] 评论时间格式正确
- [ ] 笔记标题显示（关联商品）
- [ ] 商家回复显示（如果有回复）
- [ ] 状态显示正确（正常显示/已删除）

**预期结果**：
- 所有信息显示完整
- 格式美观
- 商家回复有橙色背景

### ✅ 4. 搜索功能

**测试内容**：
- [ ] 输入评论内容关键词，能搜索到相关评论
- [ ] 输入用户名，能搜索到该用户的评论
- [ ] 搜索有500ms防抖
- [ ] 清空搜索框，恢复显示所有评论

**预期结果**：
- 搜索结果准确
- 输入时不会频繁请求
- 搜索框清空后恢复

### ✅ 5. 回复评论功能

**测试步骤**：
1. 点击某条评论的"回复"按钮
2. 在弹出的对话框中输入回复内容
3. 点击"确定"按钮

**测试内容**：
- [ ] 回复对话框正常弹出
- [ ] 输入框验证（最少5个字符，最多500个字符）
- [ ] 提交后显示"回复成功"提示
- [ ] 评论列表自动刷新
- [ ] 商家回复显示在评论下方

**预期结果**：
- 回复成功
- 页面自动刷新
- 商家回复显示正确

### ✅ 6. 删除评论功能

**测试步骤**：
1. 点击某条评论的"删除"按钮
2. 在确认对话框中点击"确定"

**测试内容**：
- [ ] 删除确认对话框正常弹出
- [ ] 点击"确定"后显示"删除成功"提示
- [ ] 评论状态变为"已删除"
- [ ] 评论列表自动刷新
- [ ] 数据概览自动更新

**预期结果**：
- 删除成功
- 评论状态更新
- 页面自动刷新

### ✅ 7. 置顶评论功能

**测试步骤**：
1. 点击某条评论的"置顶"按钮
2. 查看提示信息

**测试内容**：
- [ ] 点击置顶按钮
- [ ] 显示"置顶成功"或"取消置顶成功"提示
- [ ] 评论列表自动刷新

**注意**：
- 置顶功能需要数据库添加`is_top`字段
- 如果数据库没有该字段，功能会记录日志但不会报错

### ✅ 8. 分页功能

**测试内容**：
- [ ] 分页组件显示正确的总数
- [ ] 点击页码，加载对应页的数据
- [ ] 切换每页数量（10/20/50），数据正确加载
- [ ] 跳转到指定页码，数据正确加载
- [ ] 分页时显示loading状态

**预期结果**：
- 分页功能正常
- 数据加载正确
- loading状态显示

### ✅ 9. 响应式布局

**测试内容**：
- [ ] 在不同屏幕尺寸下查看页面
- [ ] 页面最大宽度为1600px
- [ ] 数据卡片响应式布局
- [ ] 表格在小屏幕下可横向滚动

**预期结果**：
- 布局适配不同屏幕
- 内容不会溢出
- 可读性良好

### ✅ 10. 交互动画

**测试内容**：
- [ ] 数据卡片悬停上浮效果
- [ ] 表格行悬停背景变化
- [ ] 操作按钮悬停缩放效果
- [ ] 操作按钮悬停颜色变化（蓝色/橙色/红色）

**预期结果**：
- 动画流畅
- 过渡自然
- 视觉反馈明显

## 错误处理测试

### 1. 网络错误

**测试步骤**：
1. 关闭后端服务
2. 刷新页面或执行操作

**预期结果**：
- 显示友好的错误提示
- 不会出现白屏或崩溃

### 2. 权限错误

**测试步骤**：
1. 使用没有门店的商家账号登录
2. 访问评论管理页面

**预期结果**：
- 页面正常显示
- 数据概览显示0
- 评论列表为空

### 3. 数据为空

**测试步骤**：
1. 使用有门店但没有笔记的商家账号
2. 访问评论管理页面

**预期结果**：
- 页面正常显示
- 数据概览显示0
- 评论列表为空
- 显示空状态提示

## 性能测试

### 1. 大量数据

**测试步骤**：
1. 插入1000条测试评论
2. 访问评论管理页面
3. 测试各项功能

**预期结果**：
- 页面加载速度正常（<2秒）
- 分页切换流畅
- 搜索响应快速

### 2. 搜索防抖

**测试步骤**：
1. 在搜索框快速输入多个字符
2. 观察网络请求

**预期结果**：
- 只在停止输入500ms后发送请求
- 不会频繁请求后端

## 浏览器兼容性测试

测试浏览器：
- [ ] Chrome（最新版）
- [ ] Firefox（最新版）
- [ ] Safari（最新版）
- [ ] Edge（最新版）

**预期结果**：
- 所有浏览器功能正常
- 样式显示一致
- 动画效果流畅

## 测试报告模板

```
测试日期：____年__月__日
测试人员：________
测试环境：
- 后端版本：________
- 前端版本：________
- 浏览器：________

测试结果：
✅ 通过的功能：
- 
- 

❌ 失败的功能：
- 
- 

🐛 发现的问题：
1. 
2. 

💡 改进建议：
1. 
2. 
```

## 常见问题排查

### 问题1：页面显示"获取评论列表失败"

**排查步骤**：
1. 检查后端服务是否启动
2. 检查浏览器控制台的错误信息
3. 检查商家是否有关联的门店和笔记
4. 检查后端日志

### 问题2：数据概览都显示0

**排查步骤**：
1. 检查商家是否有关联的门店
2. 检查门店是否有关联的笔记
3. 检查笔记是否有用户评论
4. 执行SQL查询验证数据

### 问题3：回复/删除功能不生效

**排查步骤**：
1. 检查浏览器控制台的错误信息
2. 检查后端日志
3. 检查权限验证是否通过
4. 检查数据库事务是否提交

### 问题4：置顶功能不生效

**排查步骤**：
1. 检查数据库是否有`is_top`字段
2. 检查后端Service实现
3. 检查后端日志

## 总结

完成以上所有测试后，确认：
- ✅ 所有核心功能正常工作
- ✅ 页面显示真实的用户评论数据
- ✅ 交互流畅，用户体验良好
- ✅ 错误处理完善
- ✅ 性能表现良好

如有问题，请参考`BACKEND_INTEGRATION.md`文档或联系开发团队。
