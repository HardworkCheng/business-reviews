# 类目对齐验证指南

本文档提供详细的验证步骤，用于确认商家运营中心与UniApp移动端的类目数据已完全对齐。

## 验证概览

需要验证三个方面：
1. ✅ 商家运营中心类目显示
2. ✅ 类目保存和读取功能
3. ✅ UniApp端类目筛选功能

---

## 任务 4.1: 验证商家运营中心类目显示

### 目标
确认商家运营中心的类目下拉框显示8个类目，且名称与UniApp首页一致。

### 验证步骤

#### 步骤1: 验证数据库类目数据
```bash
# 在MySQL中执行验证脚本
mysql -u your_username -p your_database < backend-business-reviews/sql/verify_category_alignment.sql
```

**预期结果：**
- active_category_count = 8
- 所有类目的matched = 1
- 类目名称为：美食、KTV、美发、美甲、足疗、美容、游乐、酒吧
- 按sort_order升序排列（1-8）

#### 步骤2: 启动后端服务
```bash
cd backend-business-reviews
# 确保后端服务正在运行
# 如果未运行，请启动Spring Boot应用
```

#### 步骤3: 测试类目API
```bash
# 使用curl测试API（需要先登录获取token）
curl -X GET "http://localhost:8080/api/common/categories" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**预期响应：**
```json
[
  {"id": 1, "name": "美食", "icon": "food.png", "sortOrder": 1},
  {"id": 2, "name": "KTV", "icon": "ktv.png", "sortOrder": 2},
  {"id": 3, "name": "美发", "icon": "beauty.png", "sortOrder": 3},
  {"id": 4, "name": "美甲", "icon": "nail.png", "sortOrder": 4},
  {"id": 5, "name": "足疗", "icon": "massage.png", "sortOrder": 5},
  {"id": 6, "name": "美容", "icon": "spa.png", "sortOrder": 6},
  {"id": 7, "name": "游乐", "icon": "entertainment.png", "sortOrder": 7},
  {"id": 8, "name": "酒吧", "icon": "bar.png", "sortOrder": 8}
]
```

#### 步骤4: 启动商家运营中心前端
```bash
cd front-business-reviews-Web
npm run dev
```

#### 步骤5: 登录商家运营中心
1. 打开浏览器访问 `http://localhost:5173`（或配置的端口）
2. 使用商家账号登录
3. 导航到"店铺管理"页面

#### 步骤6: 检查类目下拉框
1. 点击"新增店铺"或"编辑店铺"
2. 找到"经营类目"下拉框
3. 点击下拉框展开选项

**验证清单：**
- [ ] 下拉框显示8个类目选项
- [ ] 类目名称为：美食、KTV、美发、美甲、足疗、美容、游乐、酒吧
- [ ] 类目顺序与上述列表一致
- [ ] 类目名称与UniApp首页图标下方的文字完全一致

#### 步骤7: 对比UniApp首页
1. 打开UniApp移动端（浏览器或模拟器）
2. 查看首页的8个类目图标
3. 记录类目名称和顺序

**对比验证：**
- [ ] 商家运营中心的类目名称与UniApp首页完全一致
- [ ] 类目顺序相同
- [ ] 没有多余或缺失的类目

---

## 任务 4.2: 验证类目保存和读取

### 目标
确认修改店铺类目后能正确保存到数据库，并在刷新页面后正确显示。

### 验证步骤

#### 步骤1: 选择一个测试店铺
1. 在商家运营中心的"店铺管理"页面
2. 选择一个现有店铺进行编辑
3. 记录当前的类目ID和名称

#### 步骤2: 修改类目并保存
1. 在编辑页面，将类目修改为不同的选项（例如从"美食"改为"KTV"）
2. 点击"保存"按钮
3. 观察是否有成功提示

**验证清单：**
- [ ] 保存操作成功，显示成功提示
- [ ] 没有错误信息
- [ ] 页面返回到店铺列表

#### 步骤3: 刷新页面验证
1. 刷新浏览器页面（F5或Ctrl+R）
2. 重新进入该店铺的编辑页面
3. 查看类目下拉框的选中值

**验证清单：**
- [ ] 类目下拉框显示刚才保存的类目
- [ ] 类目名称正确
- [ ] 没有显示为空或错误的值

#### 步骤4: 验证数据库更新
```sql
-- 在MySQL中执行以下查询
SELECT id, name, category_id 
FROM shops 
WHERE id = YOUR_SHOP_ID;

-- 然后查询类目名称
SELECT c.id, c.name 
FROM categories c 
WHERE c.id = (SELECT category_id FROM shops WHERE id = YOUR_SHOP_ID);
```

**验证清单：**
- [ ] shops表的category_id字段已更新为新的类目ID
- [ ] 类目ID对应的类目名称与界面显示一致

#### 步骤5: 测试多次修改
1. 再次修改类目为另一个选项
2. 保存并刷新
3. 验证新的类目正确显示

**验证清单：**
- [ ] 可以多次修改类目
- [ ] 每次修改都能正确保存
- [ ] 数据库中的category_id正确更新

#### 步骤6: 测试无效类目ID（可选）
如果有开发者工具访问权限：
1. 尝试提交一个不存在的categoryId（如999）
2. 观察后端是否正确拒绝

**预期结果：**
- [ ] 后端返回400错误
- [ ] 显示"选择的类目无效"或类似错误信息
- [ ] 数据库中的数据未被修改

---

## 任务 4.3: 验证UniApp端类目筛选

### 目标
确认在UniApp移动端按类目筛选店铺时，修改后的店铺出现在正确的类目下。

### 验证步骤

#### 步骤1: 启动UniApp应用
```bash
cd front-business-reviews-Mobile
npm run dev:h5
# 或在微信开发者工具中打开项目
```

#### 步骤2: 访问首页
1. 打开UniApp应用
2. 确认首页显示8个类目图标
3. 记录类目图标的名称和顺序

**验证清单：**
- [ ] 首页显示8个类目图标
- [ ] 类目名称为：美食、KTV、美发、美甲、足疗、美容、游乐、酒吧
- [ ] 图标和名称清晰可见

#### 步骤3: 测试类目筛选功能
1. 点击"美食"类目图标
2. 观察是否跳转到搜索/筛选页面
3. 查看筛选结果中的店铺

**验证清单：**
- [ ] 点击类目图标后正确跳转
- [ ] 筛选结果只显示"美食"类目的店铺
- [ ] 之前在商家运营中心修改为"美食"的店铺出现在结果中

#### 步骤4: 测试所有8个类目
依次点击每个类目图标，验证筛选功能：

1. **美食类目**
   - [ ] 筛选结果正确
   - [ ] 显示的店铺category_id = 1

2. **KTV类目**
   - [ ] 筛选结果正确
   - [ ] 显示的店铺category_id = 2

3. **美发类目**
   - [ ] 筛选结果正确
   - [ ] 显示的店铺category_id = 3

4. **美甲类目**
   - [ ] 筛选结果正确
   - [ ] 显示的店铺category_id = 4

5. **足疗类目**
   - [ ] 筛选结果正确
   - [ ] 显示的店铺category_id = 5

6. **美容类目**
   - [ ] 筛选结果正确
   - [ ] 显示的店铺category_id = 6

7. **游乐类目**
   - [ ] 筛选结果正确
   - [ ] 显示的店铺category_id = 7

8. **酒吧类目**
   - [ ] 筛选结果正确
   - [ ] 显示的店铺category_id = 8

#### 步骤5: 验证实时同步
1. 在商家运营中心修改某个店铺的类目（例如从"美食"改为"KTV"）
2. 保存修改
3. 立即在UniApp中刷新或重新筛选
4. 验证该店铺出现在新类目下，不再出现在旧类目下

**验证清单：**
- [ ] 修改后的店铺立即出现在新类目的筛选结果中
- [ ] 修改后的店铺不再出现在旧类目的筛选结果中
- [ ] 无需重启应用即可看到更新

#### 步骤6: 跨端一致性验证
1. 在商家运营中心查看某个店铺的类目
2. 在UniApp中筛选该类目
3. 确认该店铺出现在筛选结果中
4. 点击店铺查看详情，确认类目信息一致

**验证清单：**
- [ ] 商家运营中心显示的类目与UniApp筛选结果一致
- [ ] 店铺详情页显示的类目信息正确
- [ ] 前后端数据完全同步

---

## 验证完成标准

所有以下条件都满足时，验证通过：

### 数据库层面
- [x] categories表包含8个status=1的类目
- [x] 类目名称为：美食、KTV、美发、美甲、足疗、美容、游乐、酒吧
- [x] 类目按sort_order升序排列（1-8）

### 后端API层面
- [x] /api/common/categories接口返回8个类目
- [x] 返回的类目数据包含id、name、icon等字段
- [x] 类目顺序正确

### 商家运营中心
- [ ] 类目下拉框显示8个类目
- [ ] 类目名称与UniApp一致
- [ ] 可以正确保存和读取类目
- [ ] 刷新页面后类目显示正确

### UniApp移动端
- [ ] 首页显示8个类目图标
- [ ] 类目名称与商家运营中心一致
- [ ] 类目筛选功能正常
- [ ] 修改后的店铺出现在正确的类目下

### 数据一致性
- [ ] 前后端使用相同的类目ID
- [ ] 类目名称在所有界面保持一致
- [ ] 修改类目后实时同步到所有端

---

## 常见问题排查

### 问题1: 类目下拉框为空
**可能原因：**
- 后端API未启动
- 前端API调用失败
- 数据库中没有status=1的类目

**排查步骤：**
1. 检查后端服务是否运行
2. 检查浏览器控制台是否有API错误
3. 执行verify_category_alignment.sql验证数据库

### 问题2: 类目名称不一致
**可能原因：**
- 数据库中的类目名称未更新
- 前端使用了硬编码的旧数据

**排查步骤：**
1. 执行fix_category_names.sql更新数据库
2. 清除浏览器缓存
3. 重启前端开发服务器

### 问题3: 保存后类目未更新
**可能原因：**
- 后端验证失败
- 数据库更新失败
- 前端缓存了旧数据

**排查步骤：**
1. 检查后端日志是否有错误
2. 直接查询数据库验证category_id
3. 清除前端缓存并刷新

### 问题4: UniApp筛选结果不正确
**可能原因：**
- 筛选API参数错误
- 店铺的category_id未正确关联
- 缓存问题

**排查步骤：**
1. 检查筛选API的请求参数
2. 验证数据库中shops表的category_id
3. 清除应用缓存并重新加载

---

## 验证报告模板

完成验证后，请填写以下报告：

```
类目对齐验证报告
==================

验证日期: ___________
验证人员: ___________

任务 4.1: 商家运营中心类目显示
- 数据库验证: [ ] 通过 [ ] 失败
- API测试: [ ] 通过 [ ] 失败
- 界面显示: [ ] 通过 [ ] 失败
- 类目一致性: [ ] 通过 [ ] 失败

任务 4.2: 类目保存和读取
- 保存功能: [ ] 通过 [ ] 失败
- 读取功能: [ ] 通过 [ ] 失败
- 数据库更新: [ ] 通过 [ ] 失败
- 多次修改: [ ] 通过 [ ] 失败

任务 4.3: UniApp端类目筛选
- 首页显示: [ ] 通过 [ ] 失败
- 筛选功能: [ ] 通过 [ ] 失败
- 8个类目测试: [ ] 通过 [ ] 失败
- 实时同步: [ ] 通过 [ ] 失败

总体评估: [ ] 全部通过 [ ] 部分通过 [ ] 未通过

备注:
___________________________________________
___________________________________________
___________________________________________
```

---

## 下一步行动

验证通过后：
1. 标记任务4为完成状态
2. 更新项目文档
3. 通知相关团队成员
4. 考虑添加自动化测试

验证未通过：
1. 记录失败的具体步骤
2. 查看常见问题排查部分
3. 修复问题后重新验证
4. 必要时寻求技术支持
