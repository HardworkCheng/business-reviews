# 商家运营中心数据显示问题排查指南

## 当前状态
✅ 页面已成功加载  
✅ 代码修复已完成  
❓ 数据显示可能需要验证  

## 快速诊断步骤

### 1. 检查浏览器控制台
1. 按 `F12` 打开开发者工具
2. 切换到 `Console` 标签
3. 刷新页面 (`Ctrl+F5` 或 `Cmd+Shift+R`)
4. 查看是否有以下日志：
   - 🚀 页面初始化，加载店铺信息...
   - 📡 API响应数据: ...
   - ✅ 店铺信息加载完成

### 2. 检查网络请求
1. 在开发者工具中切换到 `Network` 标签
2. 刷新页面
3. 查找 `/api/merchant/shops` 请求
4. 检查响应状态码是否为 200
5. 查看响应数据是否包含店铺信息

### 3. 手动刷新数据
1. 点击页面右上角的 "刷新数据" 按钮
2. 观察控制台日志
3. 检查数据是否更新

### 4. 清除缓存重试
1. 按 `Ctrl+Shift+Delete` (Windows) 或 `Cmd+Shift+Delete` (Mac)
2. 选择清除缓存和Cookie
3. 重新登录商家运营中心
4. 重新访问店铺信息页面

## 常见问题解决方案

### 问题1: 页面显示空白或加载中
**原因**: API请求失败或数据转换错误
**解决方案**:
1. 检查网络连接
2. 确认后端服务正在运行
3. 检查浏览器控制台错误信息

### 问题2: 数据显示为旧数据
**原因**: 缓存问题或数据同步延迟
**解决方案**:
1. 点击 "刷新数据" 按钮
2. 清除浏览器缓存
3. 等待几秒后重试

### 问题3: 保存后数据不更新
**原因**: 前端刷新机制问题
**解决方案**:
1. 修改数据后点击保存
2. 等待 "保存成功" 提示
3. 手动刷新页面验证

### 问题4: 数字字段显示异常
**原因**: 数据类型转换问题
**解决方案**:
1. 检查经纬度是否为数字格式
2. 检查人均消费是否正确显示
3. 如有问题，点击刷新数据

## 调试工具

### 访问调试页面
访问: `http://localhost:3000/debug/shop-debug`
这个页面提供：
- 系统状态检查
- API连接测试
- 数据加载测试
- 实时控制台日志

### 控制台命令
在浏览器控制台中输入以下命令进行调试：

```javascript
// 检查当前店铺数据
console.log('当前店铺数据:', shopForm.value)

// 强制刷新数据
loadShopInfo(true)

// 清除缓存
clearCache()

// 检查API响应
fetch('/api/merchant/shops?pageNum=1&pageSize=1', {
  headers: {
    'Authorization': 'Bearer ' + localStorage.getItem('merchant_token')
  }
}).then(r => r.json()).then(console.log)
```

## 修复验证清单

请按以下步骤验证修复是否成功：

- [ ] 1. 页面能正常加载
- [ ] 2. 控制台显示初始化日志
- [ ] 3. 店铺基本信息正确显示
- [ ] 4. 经纬度字段显示为字符串格式
- [ ] 5. 人均消费字段正确显示
- [ ] 6. 图片数据正确解析
- [ ] 7. 点击"修改信息"能进入编辑模式
- [ ] 8. 修改数据后能成功保存
- [ ] 9. 保存后数据立即更新显示
- [ ] 10. 刷新页面后数据保持最新状态

## 联系支持

如果按照以上步骤仍然无法解决问题，请提供以下信息：

1. **浏览器控制台截图** (包含错误信息)
2. **网络请求截图** (Network标签中的API请求)
3. **具体的错误现象描述**
4. **操作步骤重现**

## 技术说明

本次修复主要解决了以下问题：
1. ✅ 数据类型转换 - 数字字段正确转换为字符串
2. ✅ 数据刷新机制 - 添加强制刷新和缓存清除
3. ✅ 保存后同步 - 确保保存成功后立即显示最新数据
4. ✅ 错误处理 - 完善的重试机制和错误提示
5. ✅ 调试支持 - 详细的日志记录和调试工具

修复后的系统应该能够：
- 正确显示最新的店铺数据
- 在保存后立即刷新显示
- 提供详细的调试信息
- 自动处理网络错误和重试